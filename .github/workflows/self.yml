name: Selftest

on: push

jobs:
  selftest:
    runs-on: windows-latest
    steps:
    - uses: actions/cache@v4
      with:
        enableCrossOsArchive: true
        path: |
          ${{ env.RUNNER_TEMP }}/conda-standalone
        key: ${{ runner.os }}
    - uses: actions/checkout@v4
    - uses: dholth/action-conda-standalone/setup-conda-standalone@main
    - name: Conda Install
      run: >
        ${{ env.RUNNER_TEMP }}/conda-standalone/conda.exe create
        --prefix ${{ env.RUNNER_TEMP }}/conda-standalone/env
        --yes
        --file tests/requirements.txt
        --file tests/requirements-${{ runner.os }}.txt
        --file tests/requirements-ci.txt
        --file tests/requirements-s3.txt
        python=${{ matrix.python-version }}
    - name: Conda Info
      run: |
        ${{ env.RUNNER_TEMP }}/conda-standalone/conda.exe info
        ${{ env.RUNNER_TEMP }}/conda-standalone/env/Scripts/conda.exe info
